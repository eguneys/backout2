var Tetris=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){n(2);const i=n(3);t.exports=i.app},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var i={};function r(t,e){const n=document.createElement("canvas"),i=n.getContext("2d");this.ctx=i;let r,s,{width:a,height:h,ratio:o}=e,l=t.clientWidth,u=o;s=t.clientHeight,(r=Math.max(l,s*u))>l&&(s=(r=l)/u),n.style.width=r+"px",n.style.height=s+"px",n.width=a,n.height=h,this.width=r,this.height=s,this.aspect=this.width/this.height,t.append(n)}n.r(i),n.d(i,"vec2",function(){return l}),n.d(i,"zero",function(){return u}),n.d(i,"copy",function(){return c}),n.d(i,"equal",function(){return d}),n.d(i,"limit",function(){return f}),n.d(i,"makeMap",function(){return p}),n.d(i,"round",function(){return g}),n.d(i,"makeAttribute",function(){return y}),n.d(i,"add",function(){return w}),n.d(i,"sub",function(){return x}),n.d(i,"mul",function(){return v}),n.d(i,"div",function(){return b}),n.d(i,"scale",function(){return m}),n.d(i,"setScale",function(){return M}),n.d(i,"addScale",function(){return S}),n.d(i,"length",function(){return O}),n.d(i,"distance",function(){return k}),n.d(i,"normalize",function(){return T}),n.d(i,"direction",function(){return A}),n.d(i,"cscale",function(){return C}),n.d(i,"csub",function(){return E}),n.d(i,"cadd",function(){return R}),n.d(i,"cmul",function(){return P}),n.d(i,"cdiv",function(){return q}),n.d(i,"cmapTo",function(){return z});const s=void 0!==window.performance?window.performance:Date,a=()=>s.now(),h=window.requestAnimationFrame;function o(t,e=60){let n=!1,i=a(),r=0,s=1e3/e,o=0;this.start=()=>n?this:(n=!0,i=a(),r=h(l),this),this.stop=()=>(n=!1,0!=r&&h.cancel(r),r=0,this);const l=()=>{r=h(l);const e=a();(o+=e-i)-s>-1&&(t(s),o=0),i=e}}!function(){const t={0:"\n.....\n.   .\n. . .\n.   .\n.....\n",1:"\n ..\n. .\n  .\n  .\n....\n",2:"\n ...\n.  .\n  .\n . \n....\n",3:"\n ...\n.  .\n  .\n   .\n....\n",4:"\n   .\n  ..\n . .\n.....\n   .\n   .\n",5:"\n....\n. \n....\n   .\n....\n",6:"\n.....\n.\n.....\n.   .\n.....\n",7:"\n.....\n    .\n    .\n    .\n    .\n",8:"\n.....\n.   .\n.....\n.   .\n.....\n",9:"\n.....\n.   .\n.....\n    .\n.....\n","-":"\n\n\n.....\n\n\n",".":"\n\n\n\n\n .\n"," ":"\n\n\n\n\n\n","/":"\n    .\n   .\n  .\n .\n.\n",a:"\n  .\n . .\n.   .\n.....\n.   .\n",b:"\n....\n.   .\n....\n.   .\n....\n",c:"\n  ...\n.\n.\n.\n ....\n",d:"\n....\n.   .\n.   .\n.   .\n....\n",e:"\n ....\n.\n....\n.\n.....\n",f:"\n ....\n.\n....\n.\n.\n",g:"\n.....\n.\n. ...\n.   .\n.....\n",h:"\n.   .\n.   .\n.....\n.   .\n.   .\n",k:"\n.  .\n. .\n..\n. .\n.  .\n",i:"\n.....\n  .\n  .\n  .\n.....\n",l:"\n.\n.\n.\n.\n.....\n",n:"\n.   .\n..  .\n. . .\n.  ..\n.   .\n",p:"\n....\n.   .\n....\n.\n.\n",r:"\n....\n.   .\n....\n.   .\n.   .\n",s:"\n ...\n.   \n ..\n   .\n...\n",t:"\n.....\n  .\n  .\n  .\n  .\n",u:"\n.   .\n.   .\n.   .\n.   .\n ...\n",v:"\n.   .\n.   .\n.   .\n . .\n  .\n",w:"\n.   .\n.   .\n. . .\n. . .\n . .\n",x:"\n.   .\n . .\n  .\n . .\n.   .\n",y:"\n.   .\n . .\n  .\n  .\n  .\n",unknown:"\n.....\n.   .\n.   .\n.   .\n.....\n"};Object.keys(t).reduce((e,n)=>({[n]:t[n].replace(/^\n|\n$/g,"").split("\n").map(t=>t.split("")),...e}),{})}();function l(t=0,e=t){return[t,e]}function u(t,e=0,n=e){return t[0]=e,t[1]=n,t}function c(t,e=[]){return e[0]=t[0],e[1]=t[1],e}function d(t,e){return t[0]===e[0]&&t[1]===e[1]}function f(t,e){t[0]=Math.max(t[0],e[0]),t[0]=Math.min(t[0],e[1]),t[1]=Math.max(t[1],e[2]),t[1]=Math.min(t[1],e[3])}function p(t){return e=>(e[0]=t(e[0]),e[1]=t(e[1]),e)}const g=p(t=>Math.round(t));function y(t){return(e=t[0],n=t[1])=>(t[0]=e,t[1]=n,t)}function w(t,e,...n){return t[0]+=e[0],t[1]+=e[1],n.forEach(e=>{t[0]+=e[0],t[1]+=e[1]}),t}function x(t,e){return t[0]-=e[0],t[1]-=e[1],t}function v(t,e){return t[0]*=e[0],t[1]*=e[1],t}function b(t,e){return t[0]/=e[0],t[1]/=e[1],t}function m(t,e){return t[0]*=e,t[1]*=e,t}function M(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n}function S(t,e,n){return t[0]+=e[0]*n,t[1]+=e[1]*n,t}function O(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function k(t,e){let n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}function T(t){return m(t,1/O(t)),t}function A(t,e){return T(E(e,t))}function C(t,e){return m(c(t),e)}function E(t,e){return x(c(t),e)}function R(t,e){return w(c(t),e)}function P(t,e){return v(c(t),e)}function q(t,e){return b(c(t),e)}function z(t,e,n){return v(q(t,e),n)}function B(t,e){this.A=t,this.B=e;this.Mid=[(t[0]+e[0])/2,(t[1]+e[1])/2];let n=e[0]-t[0],i=e[1]-t[1];this.translate=this.scale=n=>{return new B(w(C(t,1-n),C(e,n)),w(C(t,n),C(e,1-n)))},this.pointFrom=(e,r)=>{return[t[0]+n*e-i*r,t[1]+i*e+n*r]}}function N(t,e){return new B(t,e)}function j(t,e,n,i){return new L(t,e,n,i)}function L(t,e,n,i){let r,s,a,h,o,l;this.width=n,this.height=i,this.w=n,this.h=i,this.copy=()=>new L(t,e,n,i),this.move=(u,c)=>{t=this.x=u,e=this.y=c,r=this.x1=t+n,s=this.y1=e+i,a=this.A=[t,e],h=this.B=[t,s],o=this.C=[r,s],l=this.D=[r,e],this.AB=N(a,h),this.BC=N(h,o),this.CD=N(o,l),this.DA=N(l,a);let d=n/2,f=i/2;this.pos=[t+d,e+f],this.size=[n,i],this.min=a,this.max=o},this.move(t,e),this.contains=n=>t<n.x&&e<n.y&&r>n.x1&&s>n.y1,this.intersects=n=>!(t>n.x1||n.x>r)&&!(e>n.y1||n.y>s),this.containsPoint=(n,i)=>n>t&&n<r&&i>e&&i<s}const D=t=>new U(t);function U(t){let e=[];this.apply=e=>e(t),this.set=n=>(t=n(t),e.forEach(e=>e(t)),t),this.mutate=(n,i)=>{let r=n(t);return i||e.forEach(e=>e(t)),r},this.subscribe=t=>e.push(t),this.unsubscribe=t=>e.splice(e.indexOf(t),1),this.log=(t=(t=>t))=>{this.subscribe(e=>console.log(t(e)))}}const{vec2:I}=i;function X({pos:t=I(0),vel:e=I(0),acc:n=I(0),gravity:i=I(0),tMax:r=40,vMax:s=2,hMax:a=40,xSubH:h=50,tHMax:o=20}){this.pos=y(t),this.vel=y(e),this.acc=y(n),this.gravity=y(i);let l=5/r,u=s*l,c=0,d=0,f=2*a/o,p=-2*a/(o*o),g=2*a*s/h,x=-2*a*s*s/(h*h),v=0;this.jumping=()=>e[1]<0,this.falling=()=>e[1]>0,this.horizontal=t=>{c=u*t},this.verticalTh=()=>{d=-p,w(e,[0,-f])},this.verticalBoost=()=>{d=-x,e[1]=-g},this.verticalBoostDrag=()=>{d=0,v=10*-x},this.fallingVelocity=()=>{d=0,this.fall()},this.slidingBoost=t=>{c=x*t,e[0]=3*g*t,d=-x,e[1]=-g};let b,m=0;this.fall=()=>{v=3*-x,m=0},this.slide=()=>{m=1},this._acceleration=()=>{let t=d;return 0===t&&(t=v),[c,t]},this.resolveX=n=>{if(!n)return null;let{xOverlap:i,xNormal:r}=n;return t[0]+=i*r,e[0]=0,c=0,i},this.resolveY=n=>{if(!n)return null;let{yOverlap:i,yNormal:r}=n;return t[1]+=i*r,e[1]=0,d=0,i},this.calculation=(n,i={})=>{const r=n;let s=I(0,0),a=I(0),h=d;0===h&&(h=v);let o=[c,h],u=Math.sign(e[1])>0?1:0;return w(s,e),S(s,o,r),S(s,[e[0],0],-l*r),S(s,[0,e[1]],-l*m*u*r),w(a,t),S(a,e,r),S(a,o,r*r*.5),{vel:s,pos:a,peakOfTheJump:s[1]>0&&e[1]<0}},this.beginUpdate=t=>{b=this.calculation(t)},this.peakOfTheJump=()=>b.peakOfTheJump,this.updateX=()=>{let{pos:n,vel:i}=b;e[0]=i[0],t[0]=n[0]},this.updateY=()=>{let{pos:n,vel:i}=b;e[1]=i[1],t[1]=n[1]},this.update=t=>{this.beginUpdate(t),this.updateX(),this.updateY()}}function Y(t,e,n=0){let{maxObjects:i=10,maxLevels:r=4}=e,s=[],a=[];const h=e=>{let n=[],i=t.x+t.width/2,r=t.y+t.height/2,s=e.y<r,a=e.x<i,h=e.x+e.w>i,o=e.y+e.h>r;return s&&h&&n.push(0),a&&s&&n.push(1),a&&o&&n.push(2),h&&o&&n.push(3),n};this.insert=o=>{let l;if(a.length>0){l=h(o);for(let t=0;t<l.length;t++)a[l[t]].insert(o)}else if(s.push(o),s.length>i&&n<r){0===a.length&&(()=>{let i=n+1,r=t.width/2,s=t.height/2,h=t.x,o=t.y;a[0]=new Y({x:h+r,y:o,width:r,height:r},e,i),a[1]=new Y({x:h,y:o,width:r,height:r},e,i),a[2]=new Y({x:h,y:o+s,width:r,height:r},e,i),a[3]=new Y({x:h+r,y:o+s,width:r,height:r},e,i)})();for(let t=0;t<s.length;t++){l=h(s[t]);for(let e=0;e<l.length;e++)a[l[e]].insert(s[t])}s=[]}},this.query=t=>{let e=h(t),n=s;if(a.length>0)for(let i=0;i<e.length;i++)n=n.concat(a[e[i]].query(t));return n},this.onRange=(t,e)=>{let n=h(t);if(s.forEach(e),a.length>0)for(let i=0;i<n.length;i++)a[n[i]].onRange(t,e)},this.clear=()=>{if(s=[],a.length>0)for(let t=0;t<a.length;t++)a[t].clear();a=[]}}function H(t,e){new Y(t,e||{});let n=[];this.addRectangle=(t,e)=>{let i={data:t,r:e};return n.push(i),i},this.removeRectangle=t=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)},this.queryRectangles=t=>n;const i=(t,e)=>t.filter(t=>(function(t,e){return!(t.x>e.x+e.w||e.x>t.x+t.w||t.y>e.y+e.h||e.y>t.y+t.h)})(e,t.r)),r=t=>{let e=this.queryRectangles(t);return i(e,t)};this.detectCollision=t=>r(t).map(t=>t.data)}function _(t,e){let n,i,r=E(e.pos,t.pos),s=t.width/2,a=e.width/2,h=s+a-Math.abs(r[0]);if(h>0){let o=(s=t.height/2)+(a=e.height/2)-Math.abs(r[1]);if(o>0)return{xNormal:n=Math.sign(r[0]),yNormal:i=Math.sign(r[1]),xOverlap:h,yOverlap:o}}return null}function G(t,e){return t.xNormal===e.xNormal&&(t.xOverlap=Math.max(t.xOverlap,e.xOverlap)),t.yNormal===e.yNormal&&(t.yOverlap=Math.max(t.yOverlap,e.yOverlap)),t}const F=[1600,900];let[$,J]=F;const W=50,V=J/W,K=$/V,Q=[1.2*V,1.2*V];let[Z,tt]=F;function et(t,e){return{x:t,y:e}}function nt(t,e,n){let i=[];for(let r=0;r<n;r++)i.push(et(t+r*V,e));return i}function it(t,e,n){let i=[];for(let r=0;r<n;r++)i.push(et(t,e+r*V));return i}let[rt,st]=F,at=C(Q,.2),ht=C(at,-1);function ot(){let t,e=this.aPlayer=new ct(this),n=this.aGround=new lt;this.userActionEvent=e=>{t=e},this.playerSlideGroundCollision=()=>{let t;return n.detectCollision(e.aabbSlide).forEach(n=>{let i=_(n.aabb,e.aabbSlide);i&&(n.slideManifold(i),t=t?G(t,i):i)}),t},this.manifoldPlayerGroundCollision=()=>{return n.detectCollision(e.aabb).reduce((t,n)=>{let i=_(n.aabb,e.aabb);return t?i?G(t,i):t:i},null)},this.update=i=>{e.userInput(t),e.update(i),n.update(i)}}function lt(){let t=new H(j(0,0,rt,st)),e=this.aTiles=[];this.detectCollision=t.detectCollision,[...nt(0,tt-V*W,K),...nt(0,tt-V,K),...nt(0,tt-2*V,K),...nt(.8*Z,tt-4*V,3),...nt(.5*Z,tt-8*V,3),...nt(.2*Z,tt-8*V,3),...it(0,0,W-2),...it(Z-V,0,W-2),...it(Z-2*V,2*V,4)].forEach(n=>(n=>{e.push(n),t.addRectangle(n,n.aabb)})(new ut(n.x,n.y))),this.update=t=>{e.forEach(t=>t.clearTrails())}}function ut(t,e){this.pos=[t,e],this.aabb=j(t,e,V,V);let n=this.trail={up:0,left:0,down:0,right:0},i={},r=!1;this.clearTrails=()=>{r||(i.left=0,i.right=0,i.up=0,i.down=0),r=!1},this.slideManifold=t=>{let{xOverlap:e,yOverlap:s,xNormal:a,yNormal:h}=t;e<=1.2*at[0]&&s>1.2*at[1]&&(a<0?i.left||(i.left=n.left++):i.right||(i.right=n.right++)),s<=1.2*at[1]&&e>1.2*at[0]&&(h<0?i.up||(i.up=n.up++):i.down||(i.down=n.down++)),r=!0}}function ct(t){let e,n,i,r=this.oPhy=D(new X({pos:[.5*rt,.5*st],tMax:30,vMax:.3*V,hMax:6*V,xSubH:13*V})),s=this.oPenetration=D([0,0]);this.aabb=j(0,0,...Q),this.aabbSlide=j(...ht,...w(R(Q,at),at)),this.userInput=t=>{e=t};let a=!1;const h=()=>{let t=r.apply(t=>t.pos());this.aabb.move(...t),this.aabbSlide.move(...R(t,ht))};this.update=o=>{(()=>{if(!e)return;let{up:t,left:s,down:h,right:o}=e;r.mutate(e=>{s?e.horizontal(-1):o?e.horizontal(1):e.horizontal(0),t?a||(n?(a=!0,e.slidingBoost(n)):i&&(a=!0,e.verticalBoost())):(a=!1,n||e.jumping()&&e.verticalBoostDrag()),i||(n?e.slide():e.jumping()||e.fall())},!0)})(),r.mutate(e=>{let r,a,l;e.beginUpdate(o/16),e.peakOfTheJump()&&e.fallingVelocity(),e.updateX(),h(),l=t.manifoldPlayerGroundCollision(),e.resolveX(l),n=l&&l.xNormal,r=l&&l.xOverlap*l.xNormal,e.updateY(),h(),l=t.manifoldPlayerGroundCollision(),e.resolveY(l),i=l&&l.yNormal<0,a=l&&l.yOverlap*l.yNormal,h(),l=t.playerSlideGroundCollision(),n=!a&&l&&Math.abs(l.yOverlap)>1.2*at[1]&&l.xNormal,s.mutate(t=>{t[0]=r,t[1]=a})})}}const dt=Math.PI;function ft(t,e){return Math.random()*(e-t)+t}function pt(t,e,n){return Math.min(Math.max(t,e),n)}function gt(t,e){e={name:"pool",warnLeak:400,...e};const n=(()=>{let t=0;return()=>t++})();let i=[],r=[];this.name=()=>e.name,this.alives=()=>i.length,this.total=()=>r.length+i.length,this.warnLeak=()=>e.warnLeak,this.toString=()=>`[${this.name()} alives: ${this.alives()} deads: ${r.length}]`,this.acquire=(e=(()=>{}))=>{let s;return this.total()>this.warnLeak()&&(console.warn(`possible pool leak at ${this.name()}.`),this.releaseLast()),e(s=r.length>0?r.pop():t(n())),i.push(s),s},this.acquireLimit=(t,e)=>{for(;this.alives()<e;)this.acquire(t)},this.release=t=>{this.releaseIndex(i.indexOf(t))},this.releaseIndex=t=>{t>-1&&r.push(i.splice(t,1)[0])},this.releaseLast=()=>{this.releaseIndex(0)},this.releaseAll=()=>{r=[...r,...i],i=[]},this.releaseIf=(t,e=(()=>{}))=>{let n=[],s=[];i.forEach(i=>{t(i)?(e(i),n.push(i)):s.push(i)}),i=s,r=[...n,...r]},this.reduce=(t,e)=>i.reduce(t,e),this.map=t=>i.map(t),this.flatMap=t=>i.flatMap(t),this.each=t=>{i.forEach(t)},this.find=t=>i.find(t),this.filter=t=>i.filter(t)}function yt(t,e=t,{yoyo:n=!1,onLap:i}){let r=0,s=1,a=n,h=!1;const o=()=>{t!==e?((()=>r=0)(),a=n,s=1,h=!1):(()=>r=1)()},l=()=>{s*=-1,i&&i()};return{update(t){if((r+=t*s)>1){if(r=1,h)return;a&&l()}r<0&&(r=0,a&&l())},smoothstop(){h=!0},settledRepeat:()=>r>=1&&!a,settled:(t=1)=>r>=t,progress:(t=1)=>r,both(n,i=n){t=n,e=i,o()},target:t=>((t||0===t)&&(e=t,o()),e),value:n=>((n||0===n)&&(t=n,o()),(()=>t+(e-t)*r)()),easing:n=>(n=>t+(e-t)*n(r))(n)}}function wt(t,e,n){let{entity:i}=n,{playerSize:r}=i;const{g:s}=e;let a=new yt(0,1,{yoyo:!0}),h=new xt(this,e,n);this.update=t=>{let{x:e,y:n}=i;a.update(t/300),h.update(t)},this.render=()=>{let{vx:t,vy:e,ax:n,ay:r}=i;0===t&&0===e?w():0!==t?y():g(),h.render()};let[o,l]=r,u=o/3,c=.5*l,d=c/2,f=.8*o,p=.8*l;const g=()=>{let{x:t,y:e,vy:n}=i;s.fr(t,e,o,l,43),s.fr(t+.3*o,e+.01*l,f,p,50)},y=()=>{let{x:t,y:e,vx:n}=i,r=n<0?-1:1;s.fr(t,e,4*u,l,43);let h=.5*o+r*o*.2,d=a.value(),g=c*d;s.fr(t+g*r+h,e+.01*l+g/3,.3*f,p,50)},w=()=>{let{x:t,y:e}=i,n=a.value(),r=c*n,h=d*n;s.fr(t,e+h,u,l-h,44),s.fr(t+u,e+r,u,l-r,44),s.fr(t+2*u,e+h,u,l-h,44),s.fr(t+.3*o,e+.01*l,f,p,50)}}function xt(t,e,n){const{g:i}=e;let{entity:r}=n,{tileSize:[s,a]}=r,h=new gt(()=>new bt(this,e,{entity:r,onRelease(t){h.release(t)}})),o=new gt(()=>new vt(this,e,{entity:r,onRelease(t){o.release(t)}})),l=0;this.update=t=>{h.each(e=>e.update(t)),o.each(e=>e.update(t)),(t=>{let{vx:e,penX:n,penY:i}=r,u=Math.abs(i),c=Math.abs(n);u>.015*a?h.acquire(t=>t.init()):u>0&&e&&l++,c>.05*s&&o.acquire(t=>t.init()),l>5&&(l=0,h.acquire(t=>t.init()))})()},this.render=()=>{h.each(t=>t.render()),o.each(t=>t.render())}}function vt(t,e,n){const{g:i}=e;let{entity:r}=n,{playerSize:[s,a],tileSize:[h,o]}=r,l=new gt(()=>new mt(this,e,{life:150,entity:r,onRelease(t){l.release(t)}})),u=!1;this.init=()=>{let{x:t,y:e,penX:n,facing:i}=r;t+=n>0?0:.5*s;for(let i=0;i<10;i++){let i=ft(.1*o,.2*o),r=ft(.1*h,.5*h)*Math.sign(n),s=-1*ft(.1*o,.5*o);l.acquire(n=>n.init({x:t,y:e,radius:i,vx:r,vy:s}))}u=!0},this.update=t=>{u&&0===l.alives()&&(u=!1,n.onRelease(this)),l.each(e=>e.update(t))},this.render=()=>{l.each(t=>t.render())}}function bt(t,e,n){const{g:i}=e;let{entity:r}=n,{playerSize:[s,a],tileSize:[h,o]}=r,l=new gt(()=>new mt(this,e,{life:150,entity:r,onRelease(t){l.release(t)}})),u=!1;this.init=()=>{let{x:t,y:e,penY:n,facing:i}=r;n<0&&(e+=o),t+=.5*s+i<0?0:.5*s;for(let n=0;n<10;n++){let n=ft(.1*o,.3*o),r=ft(.2*h,.4*h),s=-1*ft(.2*o,.4*o);r=0===i?r:r*i*-1,s=.5*s+i===0?0:.5*s,l.acquire(i=>i.init({x:t,y:e,radius:n,vx:r,vy:s}))}u=!0},this.update=t=>{u&&0===l.alives()&&(u=!1,n.onRelease(this)),l.each(e=>e.update(t))},this.render=()=>{l.each(t=>t.render())}}function mt(t,e,n){const{g:i}=e;let r,{entity:s}=n,{life:a=500}=n,{tileSize:[h,o]}=s,l=new yt(0,0,{}),u=new X({pos:[0,0],tMax:30,vMax:.3*h,hMax:10*h,xSubH:13*h});this.init=t=>{u.pos(t.x,t.y),u.vel(t.vx,t.vy),u.fall(),r=t.radius,l.both(0,1)},this.update=t=>{l.update(t/a),1===l.target()&&l.settled()&&n.onRelease(this),u.update(t/16)},this.render=()=>{let t=l.value(),[e,n]=u.pos(),s=r*t;i.fillCircle(e,n,s,5)}}function Mt(t,e,n){let i=t.backout;const{g:r,events:s}=e;this.update=t=>{let{data:e}=s;i.userActionEvent(e)},this.render=()=>{}}function St(t,e){let{screen:n}=e,i=[n.width,n.height];const r=t=>z(t,F,i);this.playerSize=r(Q),this.tileSize=r([V,V]),this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.penX=0,this.penY=0,t.oPhy.subscribe(t=>{let e=r(t.pos()),n=r(t.vel()),i=r(t._acceleration());this.x=Math.round(e[0]),this.y=Math.round(e[1]),this.vx=Math.round(n[0]),this.vy=Math.round(n[1]),this.ax=i[0],this.ay=i[1],this.facing=Math.sign(this.vx)}),t.oPenetration.subscribe(t=>{t=r(t),this.penX=t[0],this.penY=t[1]})}function Ot(t,e){let{screen:n}=e,i=[n.width,n.height];this.x=0,this.y=0;const r=t=>z(t,F,i);let s=r([V,V]),[a,h]=r(t.pos);this.x=a,this.y=h,this.tileW=s[0],this.tileH=s[1],this.trail=t.trail}function kt(t,e,n){let{entity:i}=n,{tileW:r,tileH:s}=i;const{g:a}=e;let h=new Tt(this,e,n);this.update=t=>{h.update(t)};let o=ft(10,12);this.render=()=>{let{x:t,y:e}=i;a.fr(t,e,r,s,o),h.render()}}function Tt(t,e,n){let{entity:i}=n,{tileW:r,tileH:s}=i;const{g:a}=e;let h=[0,5,5,3,2,1,0],o={up:new yt(0,0,{}),down:new yt(0,0,{}),left:new yt(0,0,{}),right:new yt(0,0,{})},l={up:0,down:0,left:0,right:0};this.update=t=>{let{trail:e}=i;!function(t,e){for(let n of Object.keys(t))e(n,t[n])}(o,(n,i)=>{i.update(t/500);i.target();e[n]!=l[n]&&(l[n]=e[n],i.both(0,1))})},this.render=()=>{let{trail:{up:t,down:e,left:n,right:r}}=i;u("up",t),u("down",e),c("left",n),c("right",r)};const u=(t,e)=>{if(!e)return;let n=h[e%h.length],{x:l,y:u}=i,c=o[t].value(),d="up"===t?0:s-.1*s,f=e-1;1!==f&&(f=h[f%h.length],a.fr(l,u+d,r,.1*s,f)),a.fr(l+(1-c)*r*.5,u+d,r*c,.1*s,n)},c=(t,e)=>{if(!e)return;let n=h[e%h.length],{x:l,y:u}=i,c=o[t].value(),d="left"===t?0:r-.1*r,f=e-1;0!==f&&(f=h[f%h.length],a.fr(l+d,u,.1*r,s,f)),a.fr(l+d,u+(1-c)*s*.5,.1*r,s*c,n)}}function At(t,e,n){let i=t.backout.aGround.aTiles.map(t=>{let i=new Ot(t,n);return new kt(this,e,{entity:i,...n})});const{g:r}=e;this.update=t=>{i.forEach(e=>e.update(t))},this.render=()=>{i.forEach(t=>t.render())}}function Ct(t,e){const{debug:n,width:i,height:r}=e.config;let s={screen:j(0,0,i,r),width:i,height:r};const{g:a}=e;let h=this.backout=new ot,o=new Mt(this,e),l=new wt(this,e,{entity:new St(h.aPlayer,{screen:s.screen}),...s}),u=new At(this,e,s);this.update=t=>{h.update(t),l.update(t),o.update(t),u.update(t)},this.render=()=>{u.render(),l.render(),o.render()}}function Et(t,e){const{debug:n,width:i,height:r}=e.config,{g:s}=e;new Ct(this,e);this.update=t=>{},this.render=()=>{}}function Rt(t,e){const{debug:n,width:i,height:r}=e.config,{g:s}=e,a=s.buffers;let h=new Et(this,e);this.update=t=>{h.update(t)},this.render=()=>{o.forEach(t=>{s.renderTarget=t,s.clear(0)}),h.render(),s.renderTarget=a.Screen,l.forEach(t=>{s.renderSource=t,s.spr()})};let o=[a.Ui,a.Collision,a.Background,a.Midground,a.Foreground,a.Buffer,a.Screen];const l=[a.Background,a.Collision,a.Midground,a.Foreground,a.Ui]}function Pt(t,e){const{width:n,height:i}=e,r=n*i;this.buffers={Screen:0,Effects:r,Buffer:2*r,Background:3*r,Midground:4*r,Foreground:5*r,Sprites:7*r,Ui:8*r,Collision:9*r};const s=this.buffers,a=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610,4278190080];let h=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64];this.renderTarget=s.Screen,this.renderSource=s.Page1;const o=t.getImageData(0,0,n,i);let l=new ArrayBuffer(o.data.length),u=new Uint8ClampedArray(l),c=new Uint32Array(l),d=new Uint8ClampedArray(n*i*22);this.clear=t=>{d.fill(t,this.renderTarget,this.renderTarget+r)},this.pset=(t,e,r)=>{t=pt(0|t,0,n),e=pt(0|e,0,i),d[this.renderTarget+e*n+t]=r},this.pget=(t,e,r)=>(t=pt(0|t,0,n),e=pt(0|e,0,i),d[r+e*n+t]),this.spr=(t=0,e=0,r=n,s=i,a=0,o=0,l=!1,u=!1)=>{for(let c=0;c<s;c++)for(let s=0;s<r;s++)if(o+c<i&&a+s<n&&o+c>-1&&a+s>-1&&!l&!u){let i=this.renderTarget+((o+c)*n+a+s),r=this.renderSource+((e+c)*n+t+s);d[r]>0&&(d[i]=h[d[r]])}},this.rspr=(t,e,r,s,a,o,l,u)=>{let c=r/2|0,f=s/2|0,p=r/2*1.41421|5,g=s/2*1.41421|5,y=-p,w=p,x=-g,v=g,b=Math.cos(-u),m=Math.sin(-u);for(let l=x;l<v;l++)for(let u=y;u<w;u++){let p=c+Math.round(b*u+m*l),g=f+Math.round(-m*u+b*l),y=u+a|0,w=l+o|0;if(y>0&&y<n&&w>0&&w<i&&p>=0&&g>=0&&p<r&&g<s){let i=this.renderSource+(p+t)+(g+e)*n,r=this.renderTarget+y+w*n;d[i]>0&&(d[r]=h[d[i]])}}};this.rspr3=(t,e,i,r,s,a,o,l)=>{let u=i/2|0,c=r/2|0,f=i/2|0,p=r/2|0,g=-f,y=f,w=-p,x=p;const v=(t=>{const e=Math.cos(t[0]),n=Math.sin(t[0]),i=Math.cos(t[1]),r=Math.sin(t[1]),s=Math.cos(t[2]),a=Math.sin(t[2]),h=e*i,o=e*r*a-n*s,l=e*r*s+n*a,u=n*i,c=n*r*a+e*s,d=n*r*s-e*a,f=-r,p=i*a,g=i*s;return(t,e,n)=>[h*t+o*e+l*n,u*t+c*e+d*n,f*t+p*e+g*n]})(o);for(let o=w;o<x;o++)for(let l=g;l<y;l++){let f,p,g,y=100,w=s+l|0,x=a+o|0;if([f,p,g]=v(l,o,y),0===g)continue;const b=y;if([f,p]=[u+Math.round(f/g*b),c+Math.round(p/g*b)],w>=0&&w<i&&x>=0&&x<r&&f>=0&&f<i&&p>=0&&p<r){let i=this.renderSource+(f+t)+(p+e)*n,r=this.renderTarget+w+x*n;d[i]>0&&(d[r]=h[d[i]])}}},this.line=(t,e,n,i,r)=>{let s,a=(i|=0)-(e|=0),h=(n|=0)-(t|=0),o=1,l=1;if(a<0&&(a=-a,l=-1),h<0&&(h=-h,o=-1),a<<=1,h<<=1,this.pset(t,e,r),h>a)for(s=a-(h>>1);t!=n;)s>=0&&(e+=l,s-=h),t+=o,s+=a,this.pset(t,e,r);else for(s=h-(a>>1);e!=i;)s>=0&&(t+=o,s-=a),e+=l,s+=h,this.pset(t,e,r)},this.circle=(t,e,n,i)=>{let r=-n,s=0,a=2-2*n;do{this.pset(t-r,e+s,i),this.pset(t-s,e-r,i),this.pset(t+r,e-s,i),this.pset(t+s,e+r,i),(n=a)<=s&&(a+=2*++s+1),(n>r||a>s)&&(a+=2*++r+1)}while(r<0)},this.fillCircle=(t,e,n,i)=>{if(n<0)return;t|=0,e|=0,i|=0;let r=-(n|=0),s=0,a=2-2*n;do{this.line(t-r,e-s,t+r,e-s,i),this.line(t-r,e+s,t+r,e+s,i),(n=a)<=s&&(a+=2*++s+1),(n>r||a>s)&&(a+=2*++r+1)}while(r<0)},this.fillRect=(t,e,n,i,r)=>{t|=0,e|=0,n|=0,i|=0;let s=Math.abs(i-e);if(this.line(t,e,n,e,r),s>0)for(;--s;)this.line(t,e+s,n,e+s,r);this.line(t,i,n,i,r)},this.fr=(t,e,n,i,r)=>{let s=0|t,a=0|e,h=t+n|0,o=e+i|0,l=Math.abs(o-a);if(this.line(s,a,h,a,r),l>0)for(;--l;)this.line(s,a+l,h,a+l,r);this.line(s,o,h,o,r)};this.render=()=>{let e=s.Effects;for(;e--;)c[e]=a[h[d[e]]];o.data.set(u),t.rotate(.5*dt),t.putImageData(o,0,0)}}function qt(){let t=this.data={};const e=[],n=function(t){const e=e=>{t[e]=!0};return function(t){switch(t.code){case"Space":e("space");break;case"ArrowUp":e("up");break;case"ArrowDown":e("down");break;case"ArrowLeft":e("left");break;case"ArrowRight":e("right");break;default:return}t.preventDefault()}}(t),i=function(t){const e=e=>{t[e]=!1};return function(t){switch(t.code){case"ArrowUp":e("up");break;case"ArrowDown":e("down");break;case"ArrowLeft":e("left");break;case"ArrowRight":e("right")}}}(t);e.push(zt(document,"keydown",n)),e.push(zt(document,"keyup",i)),this.unbind=()=>{e.forEach(t=>t())}}function zt(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function Bt(t,e){const n={debug:!0,width:512,height:288,ratio:16/9};let i=new r(t,{width:n.width,height:n.height,ratio:n.ratio}),s=new Pt(i.ctx,{width:n.width,height:n.height}),a=new Rt(null,{config:n,events:new qt,canvas:i,g:s});new o(t=>{a.update(t),a.render(),s.render()}).start()}n.d(e,"app",function(){return Bt})}]);